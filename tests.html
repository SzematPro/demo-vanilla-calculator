<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator Test Suite</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
        }
        .test-section h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .test-case {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            background: #f8f9fa;
        }
        .test-case.pass {
            background: #d4edda;
            color: #155724;
        }
        .test-case.fail {
            background: #f8d7da;
            color: #721c24;
        }
        .test-input {
            font-family: monospace;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .test-result {
            font-weight: bold;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ðŸ§® Calculator Test Suite</h1>
    
    <div class="stats" id="stats">
        <div class="stat-card">
            <div class="stat-number" id="totalTests">0</div>
            <div class="stat-label">Total Tests</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="passedTests">0</div>
            <div class="stat-label">Passed</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="failedTests">0</div>
            <div class="stat-label">Failed</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="coverage">0%</div>
            <div class="stat-label">Coverage</div>
        </div>
    </div>

    <div class="test-container">
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="runBasicTests()">Basic Operations</button>
        <button onclick="runAdvancedTests()">Advanced Features</button>
        <button onclick="runErrorTests()">Error Handling</button>
        <button onclick="runAccessibilityTests()">Accessibility</button>
    </div>

    <div class="test-container">
        <div class="test-section">
            <h2>Basic Arithmetic Operations</h2>
            <div id="basicTests"></div>
        </div>
        
        <div class="test-section">
            <h2>Advanced Features</h2>
            <div id="advancedTests"></div>
        </div>
        
        <div class="test-section">
            <h2>Error Handling</h2>
            <div id="errorTests"></div>
        </div>
        
        <div class="test-section">
            <h2>Edge Cases</h2>
            <div id="edgeTests"></div>
        </div>
        
        <div class="test-section">
            <h2>Accessibility Tests</h2>
            <div id="accessibilityTests"></div>
        </div>
    </div>

    <script>
        // Test framework
        class TestSuite {
            constructor() {
                this.tests = [];
                this.results = [];
                this.calculator = null;
            }

            async setupCalculator() {
                // Create a test calculator instance
                const testHTML = `
                    <div id="displayText">0</div>
                    <div id="operationDisplay"></div>
                    <div id="themeToggle"></div>
                    <div id="themeIcon">ðŸŒ™</div>
                `;
                document.body.insertAdjacentHTML('beforeend', testHTML);
                
                // Load calculator class
                const script = document.createElement('script');
                script.src = 'calculator.js';
                document.head.appendChild(script);
                
                return new Promise((resolve) => {
                    script.onload = () => {
                        // Wait for calculator to be available
                        setTimeout(() => {
                            this.calculator = new Calculator();
                            resolve();
                        }, 100);
                    };
                });
            }

            test(name, testFunction) {
                this.tests.push({ name, testFunction });
            }

            async runTest(test) {
                try {
                    await test.testFunction();
                    this.results.push({ name: test.name, status: 'pass' });
                    return true;
                } catch (error) {
                    this.results.push({ name: test.name, status: 'fail', error: error.message });
                    return false;
                }
            }

            async runAllTests() {
                if (!this.calculator) {
                    await this.setupCalculator();
                }

                this.results = [];
                for (const test of this.tests) {
                    await this.runTest(test);
                }
                this.updateUI();
            }

            updateUI() {
                const total = this.results.length;
                const passed = this.results.filter(r => r.status === 'pass').length;
                const failed = total - passed;
                const coverage = total > 0 ? Math.round((passed / total) * 100) : 0;

                document.getElementById('totalTests').textContent = total;
                document.getElementById('passedTests').textContent = passed;
                document.getElementById('failedTests').textContent = failed;
                document.getElementById('coverage').textContent = coverage + '%';
            }

            displayResults(containerId) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';

                this.results.forEach(result => {
                    const div = document.createElement('div');
                    div.className = `test-case ${result.status}`;
                    div.innerHTML = `
                        <span class="test-input">${result.name}</span>
                        <span class="test-result">${result.status.toUpperCase()}</span>
                    `;
                    if (result.error) {
                        div.innerHTML += `<br><small>Error: ${result.error}</small>`;
                    }
                    container.appendChild(div);
                });
            }
        }

        // Test suite instance
        const testSuite = new TestSuite();

        // Basic arithmetic tests
        function addBasicTests() {
            testSuite.test('Addition: 2 + 3 = 5', async () => {
                testSuite.calculator.clear();
                testSuite.calculator.inputNumber('2');
                testSuite.calculator.inputOperator('+');
                testSuite.calculator.inputNumber('3');
                testSuite.calculator.calculate();
                if (testSuite.calculator.currentInput !== '5') {
                    throw new Error(`Expected 5, got ${testSuite.calculator.currentInput}`);
                }
            });

            testSuite.test('Subtraction: 10 - 4 = 6', async () => {
                testSuite.calculator.clear();
                testSuite.calculator.inputNumber('1');
                testSuite.calculator.inputNumber('0');
                testSuite.calculator.inputOperator('âˆ’');
                testSuite.calculator.inputNumber('4');
                testSuite.calculator.calculate();
                if (testSuite.calculator.currentInput !== '6') {
                    throw new Error(`Expected 6, got ${testSuite.calculator.currentInput}`);
                }
            });

            testSuite.test('Multiplication: 7 Ã— 8 = 56', async () => {
                testSuite.calculator.clear();
                testSuite.calculator.inputNumber('7');
                testSuite.calculator.inputOperator('Ã—');
                testSuite.calculator.inputNumber('8');
                testSuite.calculator.calculate();
                if (testSuite.calculator.currentInput !== '56') {
                    throw new Error(`Expected 56, got ${testSuite.calculator.currentInput}`);
                }
            });

            testSuite.test('Division: 15 Ã· 3 = 5', async () => {
                testSuite.calculator.clear();
                testSuite.calculator.inputNumber('1');
                testSuite.calculator.inputNumber('5');
                testSuite.calculator.inputOperator('Ã·');
                testSuite.calculator.inputNumber('3');
                testSuite.calculator.calculate();
                if (testSuite.calculator.currentInput !== '5') {
                    throw new Error(`Expected 5, got ${testSuite.calculator.currentInput}`);
                }
            });

            testSuite.test('Decimal: 3.14 + 2.86 = 6', async () => {
                testSuite.calculator.clear();
                testSuite.calculator.inputNumber('3');
                testSuite.calculator.inputDecimal();
                testSuite.calculator.inputNumber('1');
                testSuite.calculator.inputNumber('4');
                testSuite.calculator.inputOperator('+');
                testSuite.calculator.inputNumber('2');
                testSuite.calculator.inputDecimal();
                testSuite.calculator.inputNumber('8');
                testSuite.calculator.inputNumber('6');
                testSuite.calculator.calculate();
                if (testSuite.calculator.currentInput !== '6') {
                    throw new Error(`Expected 6, got ${testSuite.calculator.currentInput}`);
                }
            });
        }

        // Advanced feature tests
        function addAdvancedTests() {
            testSuite.test('12-digit limit enforcement', async () => {
                testSuite.calculator.clear();
                // Try to input 13 digits
                for (let i = 0; i < 13; i++) {
                    testSuite.calculator.inputNumber('1');
                }
                if (testSuite.calculator.getDisplayLength() > 12) {
                    throw new Error('12-digit limit not enforced');
                }
            });

            testSuite.test('Clear function', async () => {
                testSuite.calculator.clear();
                testSuite.calculator.inputNumber('123');
                testSuite.calculator.clear();
                if (testSuite.calculator.currentInput !== '0') {
                    throw new Error('Clear function not working');
                }
            });

            testSuite.test('Backspace function', async () => {
                testSuite.calculator.clear();
                testSuite.calculator.inputNumber('123');
                testSuite.calculator.backspace();
                if (testSuite.calculator.currentInput !== '12') {
                    throw new Error('Backspace function not working');
                }
            });

            testSuite.test('Theme toggle', async () => {
                const initialTheme = testSuite.calculator.currentTheme;
                testSuite.calculator.toggleTheme();
                if (testSuite.calculator.currentTheme === initialTheme) {
                    throw new Error('Theme toggle not working');
                }
            });
        }

        // Error handling tests
        function addErrorTests() {
            testSuite.test('Division by zero', async () => {
                testSuite.calculator.clear();
                testSuite.calculator.inputNumber('5');
                testSuite.calculator.inputOperator('Ã·');
                testSuite.calculator.inputNumber('0');
                testSuite.calculator.calculate();
                if (!testSuite.calculator.isError) {
                    throw new Error('Division by zero should cause error');
                }
            });

            testSuite.test('Overflow handling', async () => {
                testSuite.calculator.clear();
                testSuite.calculator.inputNumber('999999999999');
                testSuite.calculator.inputOperator('Ã—');
                testSuite.calculator.inputNumber('999999999999');
                testSuite.calculator.calculate();
                // Should handle overflow gracefully
                if (testSuite.calculator.isError && testSuite.calculator.currentInput === 'Error') {
                    // This is expected behavior
                } else if (!testSuite.calculator.currentInput.includes('e')) {
                    // Should be in scientific notation or show error
                    throw new Error('Overflow not handled properly');
                }
            });
        }

        // Edge case tests
        function addEdgeTests() {
            testSuite.test('Multiple decimal points', async () => {
                testSuite.calculator.clear();
                testSuite.calculator.inputNumber('3');
                testSuite.calculator.inputDecimal();
                testSuite.calculator.inputNumber('1');
                testSuite.calculator.inputDecimal(); // Second decimal should be ignored
                testSuite.calculator.inputNumber('4');
                if (testSuite.calculator.currentInput !== '3.14') {
                    throw new Error('Multiple decimal points not handled correctly');
                }
            });

            testSuite.test('Leading zeros', async () => {
                testSuite.calculator.clear();
                testSuite.calculator.inputNumber('0');
                testSuite.calculator.inputNumber('0');
                testSuite.calculator.inputNumber('5');
                if (testSuite.calculator.currentInput !== '5') {
                    throw new Error('Leading zeros not handled correctly');
                }
            });
        }

        // Accessibility tests
        function addAccessibilityTests() {
            testSuite.test('Keyboard navigation', async () => {
                const display = document.getElementById('displayText');
                if (!display) {
                    throw new Error('Display element not found');
                }
                // Test if display is focusable
                display.focus();
                if (document.activeElement !== display) {
                    throw new Error('Display not focusable');
                }
            });

            testSuite.test('ARIA labels present', async () => {
                const buttons = document.querySelectorAll('.btn');
                let hasAriaLabels = true;
                buttons.forEach(button => {
                    if (!button.getAttribute('aria-label')) {
                        hasAriaLabels = false;
                    }
                });
                if (!hasAriaLabels) {
                    throw new Error('Not all buttons have ARIA labels');
                }
            });

            testSuite.test('Screen reader announcements', async () => {
                // This is a basic test - in a real scenario, you'd use a screen reader testing tool
                const display = document.getElementById('displayText');
                if (!display) {
                    throw new Error('Display element not found for screen reader testing');
                }
                // Test passes if display exists and has proper role
                if (!display.getAttribute('role')) {
                    throw new Error('Display missing role attribute');
                }
            });
        }

        // Test runner functions
        async function runAllTests() {
            addBasicTests();
            addAdvancedTests();
            addErrorTests();
            addEdgeTests();
            addAccessibilityTests();
            await testSuite.runAllTests();
            testSuite.displayResults('basicTests');
            testSuite.displayResults('advancedTests');
            testSuite.displayResults('errorTests');
            testSuite.displayResults('edgeTests');
            testSuite.displayResults('accessibilityTests');
        }

        async function runBasicTests() {
            addBasicTests();
            await testSuite.runAllTests();
            testSuite.displayResults('basicTests');
        }

        async function runAdvancedTests() {
            addAdvancedTests();
            await testSuite.runAllTests();
            testSuite.displayResults('advancedTests');
        }

        async function runErrorTests() {
            addErrorTests();
            await testSuite.runAllTests();
            testSuite.displayResults('errorTests');
        }

        async function runAccessibilityTests() {
            addAccessibilityTests();
            await testSuite.runAllTests();
            testSuite.displayResults('accessibilityTests');
        }

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>
